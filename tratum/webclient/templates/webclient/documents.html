{% extends 'webclient/base.html' %}
{% load humanize %}
{% block content %}

<div class="container-fluid documents-container">
    <div class="row title">
        <div class="col-12 document-header">
            <h1 class="text-center">Documentos</h1>
            <p class="text-center">Lorem ipsum dolor sit amet, consectetuer adipiscing elit,
                sed diam nonummy nibh euismod tincidunt ut laoreet </p>
        </div>
        <div class="col-12">
            <nav aria-label="breadcrumb" class="docs-breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Library</li>
                </ol>
            </nav>
        </div>
        <div class="col-12" id="search">
            <div class="container">
                <div class="row search">
                    <div class="col-sm-12 col-md-6 col-lg-4">
                        <form action="">
                            <div class="form-group">
                                <label for="searcher"><i class="fa fa-file-sound-o" aria-hidden="true"></i></label>
                                <input type="text" class="form-control" name="" id="searcher" aria-describedby="helpId" placeholder="Buscar">
                            </div>
                        </form>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4">
                        <form action="">
                            <div class="form-group">
                                <label for="subcategory1"><i class="fa fa-file-sound-o" aria-hidden="true"></i></label>
                                <select class="custom-select" id="root-categories">
                                    <option selected disabled>Categorías</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-4">
                        <form action="">
                            <div class="form-group">
                                <label for="subcategory"><i class="fa fa-file-sound-o" aria-hidden="true"></i></label>
                                <select class="custom-select" id="level1-categories">
                                    <option selected disabled>Seleccione primero una categoría</option>
                                    
                                </select>
                            </div>
                        </form>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    
    <div class="row docs">
        <div class="container">
            <div class="row justify-content-between">
                <div class="col-md-8 col-lg-3 filters mx-md-auto">
                    <div class="container-fluid">
                        <div class="row sub-categories">
                            <div class="col-12">
                                <span>Subcategorías</span>
                            </div>
                        </div>
                        <div class="row sub-categories-content mb-5">
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                    <label class="form-check-label" for="defaultCheck1">
                                        Default checkbox
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                    <label class="form-check-label" for="defaultCheck1">
                                        Default checkbox
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                    <label class="form-check-label" for="defaultCheck1">
                                        Default checkbox
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                    <label class="form-check-label" for="defaultCheck1">
                                        Default checkbox
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                    <label class="form-check-label" for="defaultCheck1">
                                        Default checkbox
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                    <label class="form-check-label" for="defaultCheck1">
                                        Default checkbox
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row filter">
                            <div class="col-12">
                                <span>Filtros</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                    <label class="form-check-label" for="defaultCheck1">
                                        Gratis
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                    <label class="form-check-label" for="defaultCheck1">
                                        De Pago
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 col-lg-9 documents">
                    <div class="container-fluid">
                        <div class="row justify-content-around document-list">
                            {% for doc in documents %}
                                <div class="col-md-5 doc-content">
                                    <div class="container-fluid">
                                        <div class="row row-category">
                                            <div class="col">
                                                <p class="category">{{doc.category.name}}</p>
                                            </div> 
                                        </div>
                                        <div class="row justify-content-between">
                                            <div class="col-10">
                                                <span class="doc-title">{{doc.name}}</span>
                                                <p class="doc-description">{{doc.description|default:"Sin Descripción"}}</p>
                                            </div>
                                            <div class="col-1">
                                                <i class="fas fa-info-circle float-right"></i>
                                            </div>
                                        </div>
                                        <div class="row doc-price-content">
                                            
                                            {%if doc.price is None or doc.price == 0%}
                                                <div class="col-6">
                                                    <a href="#" class="btn btn-buy float-left">Comprar</a>
                                                </div>
                                                <div class="col-6">
                                                    <span class="float-right price-free">GRATIS</span>
                                                </div>

                                            {%else%}
                                                <div class="col-6">
                                                    <a href="#" class="btn btn-buy float-left">Comprar</a>
                                                </div>
                                                <div class="col-6">
                                                    <span class="float-right price">$ {{doc.price|intcomma}}</span>
                                                </div>
                                            {%endif%}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            <div class="col-md-5 doc-content">
                                <div class="container-fluid">
                                    <div class="row row-category">
                                        <div class="col">
                                            <p class="category">Categoria</p>
                                        </div> 
                                    </div>
                                    <div class="row justify-content-between">
                                        <div class="col-10">
                                            <span class="doc-title">Título documento</span>
                                            <p class="doc-description">Lorem ipsum dolor sit amet, consectetuer adi</p>
                                        </div>
                                        <div class="col-1">
                                            <i class="fas fa-info-circle float-right"></i>
                                        </div>
                                    </div>
                                    <div class="row doc-price-content">
                                        <div class="col-6">
                                            <a href="#" class="btn btn-buy float-left">Comprar</a>
                                        </div>
                                        <div class="col-6">
                                            <span class="float-right price">$ 50.000</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 
                            <div class="col-md-5 doc-content">
                                <div class="container-fluid">
                                    <div class="row row-category">
                                        <div class="col">
                                            <p class="category">Categoria</p>
                                        </div> 
                                    </div>
                                    <div class="row justify-content-between">
                                        <div class="col-10">
                                            <span class="doc-title">Título documento</span>
                                            <p class="doc-description">Lorem ipsum dolor sit amet, consectetuer adi</p>
                                        </div>
                                        <div class="col-1">
                                            <i class="fas fa-info-circle float-right"></i>
                                        </div>
                                    </div>
                                    <div class="row doc-price-content">
                                        <div class="col-6">
                                            <a href="#" class="btn btn-buy float-left">Comprar</a>
                                        </div>
                                        <div class="col-6">
                                            <span class="float-right price">$ 50.000</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-5 doc-content">
                                <div class="container-fluid">
                                    <div class="row row-category">
                                        <div class="col">
                                            <p class="category">Categoria</p>
                                        </div> 
                                    </div>
                                    <div class="row justify-content-between">
                                        <div class="col-10">
                                            <span class="doc-title">Título documento</span>
                                            <p class="doc-description">Lorem ipsum dolor sit amet, consectetuer adi</p>
                                        </div>
                                        <div class="col-1">
                                            <i class="fas fa-info-circle float-right"></i>
                                        </div>
                                    </div>
                                    <div class="row doc-price-content">
                                        <div class="col-6">
                                            <a href="#" class="btn btn-buy float-left">Comprar</a>
                                        </div>
                                        <div class="col-6">
                                            <span class="float-right price">$ 50.000</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-5 doc-content">
                                <div class="container-fluid">
                                    <div class="row row-category">
                                        <div class="col">
                                            <p class="category">Categoria</p>
                                        </div> 
                                    </div>
                                    <div class="row justify-content-between">
                                        <div class="col-10">
                                            <span class="doc-title">Título documento</span>
                                            <p class="doc-description">Lorem ipsum dolor sit amet, consectetuer adi</p>
                                        </div>
                                        <div class="col-1">
                                            <i class="fas fa-info-circle float-right"></i>
                                        </div>
                                    </div>
                                    <div class="row doc-price-content">
                                        <div class="col-6">
                                            <a href="#" class="btn btn-buy float-left">Comprar</a>
                                        </div>
                                        <div class="col-6">
                                            <span class="float-right price-free">GRATIS</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-5 doc-content">
                                <div class="container-fluid">
                                    <div class="row row-category">
                                        <div class="col">
                                            <p class="category">Categoria</p>
                                        </div> 
                                    </div>
                                    <div class="row justify-content-between">
                                        <div class="col-10">
                                            <span class="doc-title">Título documento</span>
                                            <p class="doc-description">Lorem ipsum dolor sit amet, consectetuer adi</p>
                                        </div>
                                        <div class="col-1">
                                            <i class="fas fa-info-circle float-right"></i>
                                        </div>
                                    </div>
                                    <div class="row doc-price-content">
                                        <div class="col-6">
                                            <a href="#" class="btn btn-buy float-left">Comprar</a>
                                        </div>
                                        <div class="col-6">
                                            <span class="float-right price-free">GRATIS</span>
                                        </div>
                                    </div>
                                </div>
                            </div> -->
                        </div>
                    </div>
                </div>
                
            </div>
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1">Antetior</a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                    <a class="page-link" href="#">Siguiente</a>
                    </li>
                </ul>
            </nav>
        </div>

    </div>
</div>

{% endblock %}

{% block extra_js %}

<script>

    $(function(){
        createSticky($("#search"));
    });

    function createSticky(sticky) {
        if (typeof sticky !== "undefined") {
            var	pos = sticky.offset().top,
                win = $(window);
            win.on("scroll", function() {
                win.scrollTop() >= pos ? sticky.addClass("fixed") : sticky.removeClass("fixed");      
            });			
        }
    }
  
    toastr.options = {
        "closeButton": false,
        "debug": false,
        "newestOnTop": false,
        "progressBar": true,
        "positionClass": "toast-top-right",
        "preventDuplicates": true,
        "onclick": null,
        "showDuration": "1000",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
    }


    function get_children_categories(category_slug){
        axios.get(`/api/documents/categories/${category_slug}/children/`)
            .then(function(response){
                if (response.data.length > 0){
                    $('#level1-categories').empty()
                    $(response.data).each(function(i,v){
                        
                        $('#level1-categories').append(
                            `
                                <option value="${v.slug}">${v.name}</option>
                            `
                        )
                        
                    })
                    $('#level1-categories').prepend(
                        `<option selected value="" >Seleccione una subcategoría</option>`
                    )
                }
            })
            .catch(function(error){
                toastr.error(error)
            });
    }

    function get_root_categories(category, slug){
        axios.get("{% url 'api:document_manager:categories-root-list' %}")
            .then(function(response){
                $('#root-categories').empty()
                if (response.data.length > 0){
                    $(response.data).each(function(i,v){
                        if(v.slug === slug){
                            $('#root-categories').append(
                            `
                                <option selected value="${v.slug}">${v.name}</option>
                            `
                            )
                        }
                        else{
                            $('#root-categories').append(
                                `
                                    <option value="${v.slug}">${v.name}</option>
                                `
                            )
                        }
                    })
                    $('#root-categories').prepend(
                        `<option value="" >Seleccione una categoría</option>`
                    )
                    console.log($('#root-categories').val())
                    get_children_categories($('#root-categories').val())

                }
                else {
                    $('#root-categories').append(
                        `<option value="" >No hay categorías</option>`
                    ) 
                }
            })
            .catch(function(error){
                toastr.error(error)
            });
    }


    $('#root-categories').on('change', function(e){
        e.preventDefault()
        window.location.replace(
            `/category/${$(this).val()}/documents/`
        )
    })

    $(document).ready(function(){
        category = '{{category}}'
        category_slug = '{{category.slug}}'
        category_ancestors = '{{category.get_ancestors.count}}'
        switch (category_ancestors) {
            case '0': 
                get_root_categories(category, category_slug)
                break;
            case '1': 
                alert('1 ancestor');
                break;
            case '2': 
                alert('2 ancestor');
                break;		
            case '3': 
                alert('3 ancestor');
                break;
            default:
                alert('Nobody Wins!');
        }

    })

    




    
</script>

{% endblock %}